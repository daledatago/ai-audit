name: CI

on:
  pull_request:
  push:
    branches: [ main ]

jobs:
  validate-specs:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Validate JSON schemas (debug)
        run: |
          python - << 'PY'
          import json, glob
          files = sorted(glob.glob("schemas/*.json"))
          if not files:
              raise SystemExit("No schemas found in schemas/*.json")
      
          for f in files:
              try:
                  with open(f, "r", encoding="utf-8") as fh:
                      data = fh.read()
                  json.loads(data)
                  print("OK", f)
              except Exception as e:
                  print("\nâŒ JSON validation failed for:", f)
                  print("Error:", repr(e))
                  print("\nFirst 200 chars:\n", data[:200])
                  raise
          PY

      - name: Validate YAML files (question bank + prompts)
        run: |
          python - << 'PY'
          import glob
          import yaml
          files = glob.glob("question_bank/*.y*ml") + glob.glob("prompts/*.y*ml")
          for f in files:
              with open(f, "r", encoding="utf-8") as fh:
                  yaml.safe_load(fh)
              print("OK", f)
          PY
        # install PyYAML
      - name: Install PyYAML
        run: pip install pyyaml
